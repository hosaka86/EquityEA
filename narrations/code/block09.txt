Now for the core drawdown calculation logic. (long-break) We first determine which value to track, (break) based on the selected mode. (break) Equity mode uses current equity, (break) balance mode uses current balance. (long-break) If the current value exceeds our peak, (break) we update the peak and log it periodically. (break) Then we calculate the current drawdown, (break) which is simply peak minus current value. (break) We also calculate it as a percentage of the peak. (long-break) If the current drawdown exceeds the maximum we've seen, (break) we update the maximum drawdown values. (break) This gives us both current and historical worst-case measurements. (long-break)