The UpdateTradingStatistics function runs on every tick, (break) checking for newly closed trades. (long-break) First, we check if a new day has started. (break) If so, (break) we reset the daily profit counter. (break) Then we select history from the last processed trade until now. (long-break) We loop through all deals, (break) skipping any we've already processed. (break) For each new exit deal, (break) we update all the same counters, (break) total trades, wins, losses, and profit metrics. (break) When a new trade is detected, (break) we recalculate the win rate and log it periodically. (long-break)