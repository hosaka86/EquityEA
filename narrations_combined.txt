[interlude_section1]
If you're trading with a prop firm, (break) you know the game. (break)(break) They give you capital, (break) sometimes fifty thousand, (break) a hundred thousand, (break) even more. (break)(break) But there's a catch. (break)(break) One bad day, (break) one emotional revenge trade, (break) one overnight gap, (break) and you're done. (break)(break)(break) Most prop firms have a maximum drawdown rule. (break) Usually ten percent. (break) Some are even stricter, (break) five or six percent. (break)(break) Hit that line? (break) Account closed. (break) Challenge failed. (break) Fee gone. (break)(break)(break) And here's the worst part. (break)(break) You might not even realize you're in danger. (break) You're watching your charts, (break) managing your positions, (break) and suddenly, (break) boom, (break) you get the email. (break) Account violated. (break)(break) Game over.

[interlude_section2]
So what do most traders do? (break)(break) They try to calculate it manually. (break)(break) They open their account history, (break) try to find their peak balance, (break) do the math in their head, (break) or worse, (break) pull out a calculator. (break)(break)(break) But here's the problem. (break)(break) Your equity changes every second. (break) Every tick. (break) Every market movement. (break)(break) Are you really going to sit there, (break) constantly calculating, (break) while also trying to trade? (break)(break)(break) And what about when you're running multiple positions? (break) Or trading multiple pairs? (break) Or sleeping while a position is open overnight? (break)(break)(break) You can't watch it twenty-four seven. (break) Nobody can.

[interlude_section3]
That's exactly why I built this Equity Monitor EA. (break)(break)(break) It does one thing, (break) and it does it perfectly. (break)(break) It watches your account. (break) Every single tick. (break) Every price movement. (break) Twenty-four hours a day. (break)(break)(break) It tracks your peak equity, (break) or your peak balance, (break) your choice. (break)(break) It calculates your current drawdown, (break) and your maximum drawdown, (break) in real time. (break)(break)(break) And when you hit your limit? (break)(break) It closes everything. (break) Instantly. (break) Automatically. (break) No hesitation. (break) No emotions. (break) No second-guessing. (break)(break)(break) It's your killswitch. (break) Your safety net. (break) Your account guardian.

[interlude_section4]
For prop firm traders, (break) this isn't just convenient. (break)(break) It's essential. (break)(break)(break) Think about it. (break)(break) You paid for that challenge. (break) Maybe a hundred dollars. (break) Maybe five hundred. (break) Maybe more. (break)(break) You spent weeks passing the evaluation. (break) You finally got funded. (break)(break)(break) Are you really going to risk it all, (break) because you weren't paying attention for five minutes? (break)(break)(break) This EA gives you what prop firms give themselves, (break) automated risk management. (break)(break) They protect their capital with algorithms. (break) Why shouldn't you? (break)(break)(break) Set your maximum drawdown to nine percent. (break) Give yourself a one percent buffer. (break) Trade with confidence. (break) Sleep at night. (break)(break) Your account, (break) your career, (break) your edge, (break) all protected.

[interlude_section5]
Before we dive into the code, (break) let me show you what this EA can do. (break)(break) Real-time equity and balance tracking. (break) Your choice, (break) trade by trade. (break)(break) Current drawdown, (break) and maximum drawdown, (break) both calculated automatically. (break)(break) Configurable killswitch, (break) with multiple trigger modes. (break)(break) Full trading statistics, (break) win rate, (break) total trades, (break) profit and loss. (break)(break) Professional dashboard, (break) positioned anywhere you want on your chart. (break)(break) Auto-save functionality, (break) so you never lose your tracking data. (break)(break)(break) And the best part? (break)(break) You're about to see exactly how it works. (break) Every line of code. (break) Every calculation. (break) Every safety mechanism. (break)(break) Let's build it.

[block01]
Welcome to this MQL5 tutorial. (break) Today we're building a professional equity monitoring Expert Advisor. (long-break) Let's start with the header section. (break) We define the property directives that describe our EA, (break) including the version number, (break) copyright information, (break) and a detailed description of all features. (long-break) We also set up some essential defines. (break) The VERSION constant will be used throughout the code, (break) and the DASHBOARD PREFIX ensures all our graphical objects have unique names. (long-break)

[block02]
Next up, (break) we define three important enumerations. (long-break) The first one is ENUM CORNER POSITION, (break) which allows users to choose where the dashboard appears on their chart. (break) Top left, top right, bottom left, or bottom right. (long-break) Then we have ENUM DRAWDOWN MODE. (break) This is really important. (break) Equity-based drawdown includes your floating profit and loss, (break) so it responds immediately to market movements. (break) Balance-based drawdown, (break) on the other hand, (break) only counts closed trades, (break) giving you a more conservative measurement. (long-break) Finally, (break) the ENUM KILLSWITCH TRIGGER determines how the protection system activates. (break) Current drawdown resets when you reach a new peak, (break) while maximum drawdown tracks your worst performance ever, (break) which is what most prop firms use. (long-break)

[block03]
Now let's set up the input parameters. (break) These are the settings users can adjust without modifying the code. (long-break) We organize them into four logical sections. (break) General settings include the magic number filter and drawdown calculation mode. (break) Display settings control the visual dashboard, (break) like position, colors, and font size. (break) File management settings handle the auto-save feature, (break) so your statistics persist even after restarting MetaTrader. (long-break) And finally, (break) the killswitch protection settings. (break) Set a maximum drawdown threshold, (break) choose the trigger type, (break) and decide if you want aggressive mode, (break) which continuously closes any new positions that appear. (long-break)

[block04]
Time to declare our global variables. (break) These hold the EA's state throughout its lifetime. (long-break) We have equity tracking variables, (break) like peak equity, maximum drawdown, and current drawdown values. (break) Both absolute amounts and percentages. (long-break) Trading statistics variables track your performance, (break) total trades, winning trades, losing trades, (break) win rate, and profit metrics. (break) We also track daily profit and loss separately. (long-break) File management variables remember when we last saved, (break) and whether we successfully loaded previous stats. (break) Dashboard variables control the visual display, (break) and killswitch variables track if the protection system has been triggered. (long-break) Finally, (break) we have logging control to prevent spamming the terminal with too many messages. (long-break)

[block05]
Let's implement the On Init function, (break) which runs once when the EA starts. (long-break) First, we print a nice header to the terminal so you know the EA is running. (break) Then we grab the current account balance and equity. (long-break) If auto-save is enabled, (break) we try to load previous statistics from file. (break) This is crucial, (break) because it allows the EA to remember your peak equity and maximum drawdown, (break) even after restarting MetaTrader. (long-break) If no previous stats exist, (break) we initialize the peak equity based on the chosen mode, (break) either current equity or current balance. (break) Then we calculate all historical statistics from closed trades. (long-break) If the dashboard is enabled, (break) we create all the visual objects on the chart. (break) Finally, we initialize the timestamps and print a confirmation message. (long-break)

[block06]
The On Deinit function runs when the EA stops. (long-break) We print a header showing the deinitialization reason, (break) which is helpful for debugging. (break) If auto-save is enabled, (break) we save the final statistics to file, (break) ensuring no data is lost. (break) Then we clean up by deleting all dashboard objects from the chart. (break) This prevents cluttering the screen with leftover visual elements. (long-break)

[block07]
On Tick is the heart of our EA, (break) called on every price tick. (long-break) We follow a logical sequence. (break) First, update account values like balance and equity. (break) Then update equity tracking and calculate drawdowns. (break) Next, monitor the killswitch to see if we need to close positions. (long-break) We check for new closed trades and update statistics accordingly. (break) The dashboard is updated every second, (break) not on every tick, (break) to avoid excessive CPU usage. (break) Finally, (break) if the auto-save interval has elapsed, (break) we save the current statistics to file. (long-break)

[block08]
This simple but crucial function updates the account values. (long-break) We fetch the current balance from the account, (break) then the current equity. (break) The floating profit or loss is simply the difference between equity and balance. (break) This tells us how much unrealized profit we have in open positions. (long-break)

[block09]
Now for the core drawdown calculation logic. (long-break) We first determine which value to track, (break) based on the selected mode. (break) Equity mode uses current equity, (break) balance mode uses current balance. (long-break) If the current value exceeds our peak, (break) we update the peak and log it periodically. (break) Then we calculate the current drawdown, (break) which is simply peak minus current value. (break) We also calculate it as a percentage of the peak. (long-break) If the current drawdown exceeds the maximum we've seen, (break) we update the maximum drawdown values. (break) This gives us both current and historical worst-case measurements. (long-break)

[block10]
Let's implement the trading statistics system. (long-break) The CalculateHistoricalStats function runs during initialization, (break) processing all closed trades from account history. (long-break) We reset all counters to zero, (break) then determine today's start time for daily profit tracking. (break) We select the entire history and loop through all deals. (long-break) For each deal, (break) we check if it matches our magic number filter. (break) We only process exit deals, (break) which represent closed positions. (break) For each closed trade, (break) we calculate the true net profit, (break) including swap and commission. (long-break) We increment the appropriate counters, (break) winning or losing, (break) and accumulate the profit and loss totals. (break) If the trade closed today, (break) we add it to the daily profit. (break) At the end, (break) we calculate derived metrics like net profit and win rate. (long-break)

[block11]
The UpdateTradingStatistics function runs on every tick, (break) checking for newly closed trades. (long-break) First, we check if a new day has started. (break) If so, (break) we reset the daily profit counter. (break) Then we select history from the last processed trade until now. (long-break) We loop through all deals, (break) skipping any we've already processed. (break) For each new exit deal, (break) we update all the same counters, (break) total trades, wins, losses, and profit metrics. (break) When a new trade is detected, (break) we recalculate the win rate and log it periodically. (long-break)

[block12]
Now for the killswitch protection system, (break) one of the most important features. (long-break) The MonitorKillswitch function checks if drawdown has exceeded the threshold. (break) If the threshold is zero, (break) the killswitch is disabled. (long-break) We select which drawdown to monitor, (break) current or maximum, (break) based on the trigger type setting. (break) If the monitored drawdown exceeds the threshold, (break) we trigger the killswitch. (long-break) We print a detailed warning message, (break) show an alert to the user if enabled, (break) and immediately close all positions. (break) In aggressive mode, (break) the EA continuously closes any positions that appear, (break) ensuring your account stays protected. (long-break)

[block13]
Before we can close positions, (break) we need to determine the correct filling mode for each symbol. (long-break) Different brokers support different order filling modes. (break) FOK means fill or kill, (break) IOC is immediate or cancel, (break) and Return mode allows partial fills. (break) We check which modes the symbol supports using bitwise flags, (break) and return the most appropriate one. (long-break)

[block14]
Now the CloseAllPositions function, (break) which implements robust position closing logic. (long-break) We count how many positions exist, (break) and iterate backwards to avoid index shifting issues. (break) For each position, (break) we must select it by ticket to ensure our data is current. (long-break) We check if trading is allowed on the symbol. (break) Then we prepare a trade request structure, (break) setting the action to deal, (break) specifying the position ticket, volume, and symbol. (break) We use the symbol's correct filling mode. (long-break) For buy positions, (break) we close with a sell order at the bid price. (break) For sell positions, (break) we close with a buy order at the ask price. (break) We implement retry logic with up to three attempts. (long-break) If the price becomes invalid, (break) we refresh it and retry. (break) If the market is closed, (break) we stop trying. (break) We only log errors after all retry attempts have failed, (break) keeping the terminal output clean. (break) At the end, (break) we print a summary of how many positions were closed or failed. (long-break)

[block15]
Let's implement the file management system. (long-break) The ShouldAutoSave and ShouldLog functions check if enough time has elapsed, (break) preventing excessive file writes and log spam. (long-break) SaveStatsToFile opens a CSV file and writes all current statistics. (break) The file includes a header row, (break) then a data row with timestamp, peak equity, drawdown values, (break) trade counts, win rate, and profit metrics. (break) This CSV format can be imported into Excel for analysis. (long-break) LoadStatsFromFile does the opposite. (break) It checks if a previous stats file exists, (break) opens it, (break) skips the header, (break) and reads the most recent statistics. (break) This allows the EA to resume monitoring from where it left off, (break) preserving your peak equity and maximum drawdown across restarts. (long-break)

[block16]
Now let's build the visual dashboard. (long-break) The CreateDashboard function creates all the label objects on the chart. (break) We start with a background panel for better visibility, (break) then add a title showing the EA name and version. (long-break) The dashboard is organized into sections. (break) Current Status shows balance, equity, and floating profit. (break) Drawdown Analysis displays the peak value, current drawdown, and maximum drawdown. (break) Trading Statistics shows total trades, win rate, net profit, and daily profit. (long-break) Each label has a key and a value object, (break) positioned using pixel offsets. (break) We use the Consolas font for monospaced alignment, (break) and apply colors based on user preferences. (break) At the bottom, (break) we add a footer showing whether auto-save is enabled. (long-break)

[block17]
The UpdateDashboard function runs every second, (break) refreshing all the displayed values. (long-break) We get the account currency, (break) then update each value label with current data. (break) Balance and equity are straightforward. (break) Floating profit gets colored green or red depending on whether it's positive or negative. (long-break) The drawdown section shows peak value, current drawdown, and maximum drawdown, (break) all with percentages in parentheses. (break) Trading statistics show total trades with a breakdown of wins and losses, (break) win rate as a percentage, (break) and net profit colored appropriately. (break) Daily profit also gets dynamic coloring. (break) Finally, we call ChartRedraw to update the display. (long-break) DeleteDashboard removes all objects with our prefix when the EA stops, (break) keeping the chart clean. (long-break)

[block18]
Finally, (break) the helper functions that make everything work. (long-break) CreateLabel is a utility function that creates a text label object on the chart. (break) It takes parameters for name, text, position, font size, color, and font family. (break) We set properties like corner anchor, distances, and make sure the object is not selectable. (long-break) UpdateLabelText simply changes the text of an existing label, (break) and UpdateLabelColor changes its color. (break) These are called frequently by the dashboard update function. (long-break) GetDeinitReasonText translates the numeric deinitialization reason code, (break) into a human-readable string. (break) This helps with debugging when the EA stops. (long-break) And that's it! (break) You now have a complete, professional-grade equity monitoring EA. (break) This EA tracks your drawdown in real time, (break) maintains statistics across restarts, (break) and protects your account with an automated killswitch. (break) Thanks for following along, (break) and happy trading! (long-break)

